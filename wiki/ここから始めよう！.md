# 必須事項
| AviUtl                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | **AviUtl ExEdit2 (推奨)**                                                                                                                                                                                                                                                                                                                                                                                                            |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [AviUtl](http://spring-fragrance.mints.ne.jp/aviutl/) + [拡張編集プラグイン](http://spring-fragrance.mints.ne.jp/aviutl/) + [L-SMASH Works](https://github.com/Mr-Ojii/L-SMASH-Works-Auto-Builds/releases/latest) + [easymp4](https://aoytsk.blog.jp/aviutl/easymp4.zip)<br>- **インストーラー：** [AviUtl インストーラースクリプト](https://github.com/menndouyukkuri/aviutl-installer-script)<br><br>*すべてのプラグインを `aviutl\Plugins` フォルダにインポートする* | [AviUtl ExEdit2 **(インストーラ版)**](http://spring-fragrance.mints.ne.jp/aviutl/) + [L-SMASH Works](https://github.com/Mr-Ojii/L-SMASH-Works-Auto-Builds/releases/latest) + [MP4Exporter](https://apps.esugo.net/aviutl2-mp4exporter/)<br><br>*`AviUtl2\lwinput.aui2`と`MP4Exporter.auo2`プラグインを`C:\ProgramData\aviutl2\Plugin`フォルダにインポートする* |
- **[PowerShell](https://github.com/PowerShell/PowerShell)**
- **フォント：** ロダンNTLG [DB](https://fontworks.co.jp/fontsearch/rodinntlgpro-db/) + [EB](https://fontworks.co.jp/fontsearch/rodinntlgpro-eb/)
- システムロケールは **必ず「日本語（日本）」** に設定してください [(変更方法はこちら)](#システムロケールの変更)
- **日本語言語パック**をインストールする必要があります [(インストール手順はこちら)](https://support.microsoft.com/ja-jp/windows/windows-%E7%94%A8%E8%A8%80%E8%AA%9E%E3%83%91%E3%83%83%E3%82%AF-a5094319-a92d-18de-5b53-1cfc697cfca8)
- AviUtlの基本的な知識

# 動画の作り方

**黒い背景で、すべてのUI（レーンを含む）が非表示になっているクリーンな録画**が必要です。下記スクリーンショットのように：

<img width=60% height="auto" alt="" src="https://github.com/user-attachments/assets/46578e52-a3e6-4248-9e2c-f61486cc6af6" />

以下の手順に従ってください：
1. [Sonolus](https://sonolus.com/)で譜面を撮影する
2. **背景を黒**にし、**`Stage` OFF**、**`Hide UI` ONかALL** にして、動画をスクリーン録画します。

> [!NOTE]
> 背景を変更するには、`設定 > 背景 > 選択` に移動してください
> 
> <img width=60% height="auto" alt="" src="https://github.com/user-attachments/assets/a138e3b7-50cd-49e0-8977-c1df60ba9a3e" />

3. 撮影したプレイ動画のファイルをパソコンに転送する
   - まだダウンロードしていない場合は、[FFmpeg](https://www.ffmpeg.org/) エンコーダーをダウンロードする
4. **(AviUtlのみ)** [FFmpeg](https://www.ffmpeg.org/) エンコーダーをダウンロードし、使用してください（`ffmpeg -i source.mp4 output.mp4`）
   - **この手順はAviUtl特有の奇妙なバグのため必須です**：ソース動画のフレームレートがプロジェクトと一致しない場合、同期が遅延します。
   - 代替手段として、動画編集ソフトでこの処理を行うことも可能です。
5. 下の利用方法に従って UI を後付けする

# 利用方法
0. [AviUtlとその他のプラグインをインストールする](#必須事項)
1. 右のReleasesから最新のバージョンのzipを[ダウンロード](https://github.com/TootieJin/pjsekai-overlay-APPEND/releases/latest/)する
   - **(任意)** 必須ではないアセットを使用する場合は、`extra-assets.zip` をダウンロードできます。
2. ファイルを解凍するディレクトリは、**非ASCII文字を含まず、管理者権限を必要としない**ものを選んでください。（詳細は[#5](https://github.com/TootieJin/pjsekai-overlay-APPEND/issues/5)を参照）
3. 使用したいAviUtlに応じて以下の手順に従ってください：

| AviUtl                                                                                                                                                                                                                                                                                                                           	| **AviUtl ExEdit2**                                                                      	|
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------	|--------------------------------------------------------------------------------------------	|
| 1. **`aviutl.exe`が起動している状態で**、`pjsekai-overlay-APPEND.exe`を開く<br>2. **変更を適用するためにAviUtlを再起動する。**     | 1. `pjsekai-overlay-APPEND.exe`を開く<br>2. `2`を押してAviUtl ExEdit2インスタンスを選択     |

4. `pjsekai-overlay-APPEND.exe`コンソールで、譜面IDを接頭辞込みで入力して下さい。
- **公式サーバー：**
   - `sekai-rush-`: Proseka Rush ([sekairush.shop](https://sekairush.shop))
- **カスタムサーバー：**
   - `chcy-`: Chart Cyanvas
      - `0`: アーカイブ([cc.sevenc7c.com](https://cc.sevenc7c.com))
      - `1`: 分岐サーバー([chart-cyanvas.com](https://chart-cyanvas.com))
      - `その他(URLドメイン)`: 異なるCyanvasインスタンス
   - `ptlv-`: Potato Leaves ([ptlv.sevenc7c.com](https://ptlv.sevenc7c.com))
   - <del>`utsk-`: Untitled Sekai ([us.pim4n-net.com](https://us.pim4n-net.com))</del>
   - `UnCh-`: UntitledCharts ([untitledcharts.com](https://untitledcharts.com))
   - `coconut-next-sekai-`: Next SEKAI ([coconut.sonolus.com/next-sekai](https://coconut.sonolus.com/next-sekai))
   - `lalo-`: [laoloser](https://www.youtube.com/@laoloserr)のサーバー([sonolus.laoloser.com](https://laoloser.com/sonolus))
- **独立サーバー：**
   - <del>`lalo-`: [laoloser](https://www.youtube.com/@laoloserr)のサーバー ([sonolus.laoloser.com](https://laoloser.com/sonolus))</del>
   - `skyra-`: [osciris](https://www.tiktok.com/@oscirissss)のサーバー ([Skyra](https://plumnet.live/)) **(ライセンス必須)**
- **ローカルサーバー：**
   - `sync-`: ローカルサーバー ([ScoreSync](https://github.com/Piliman22/ScoreSync) + [ScoreSync Modern](https://github.com/UntitledCharts/ScoreSync-Modern))

5. AviUtlで新規プロジェクトを作成し、**画像サイズ1920x1080(または1440x1080) & フレームレート60** を設定する

| AviUtl                                                                                                                                                                                                                                                                                                                           	| **AviUtl ExEdit2**                                                                      	|
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------	|--------------------------------------------------------------------------------------------	|
| `拡張編集`ウィンドウ内の任意の場所で右クリック > `新規プロジェクトを作成`<br><br><img width="auto" height="auto" alt="image" src="https://github.com/user-attachments/assets/fee1d0ab-27ae-4eba-9be4-db3adcc0f567" /> 	| `ファイル > プロジェクトを新規作成` に移動してください<br><br><img width="auto" height="auto" alt="image" src="https://github.com/user-attachments/assets/b8dfadc6-a5cd-4436-8002-01e6a59c8cd2" /> 	|

6. `pjsekai-overlay-APPEND\dist\[譜面ID]`ディレクトリに移動して、指定したexo/alias(.object)ファイルをインポートします：

|      	| AviUtl                                                          	| **AviUtl ExEdit2**                                                	|
|------	|-----------------------------------------------------------------	|-------------------------------------------------------------------- |
| 16:9 	| `main_jp_16-9_1920x1080.exo`<br>`v1-skin_jp_16-9_1920x1080.exo` 	| `main2_16-9_1920x1080.object`<br>`v1-skin2_16-9_1920x1080.object` 	|
| 4:3  	| `main_jp_4-3_1440x1080.exo`<br>`v1-skin_jp_4-3_1440x1080.exo`   	| `main2_4-3_1440x1080.object`<br>`v1-skin2_4-3_1440x1080.object`   	|

7. exo/alias(.object)が提供する**タイムラインで動画と音声ファイルを選択**

| AviUtl                                                                                                                                                                                                                                                                                                                           	| **AviUtl ExEdit2**                                                                      	|
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------	|--------------------------------------------------------------------------------------------	|
| 1. `動画ファイル[標準描画]`をダブルクリック<br><br><img width="auto" height="auto" alt="image" src="https://github.com/user-attachments/assets/37dda2f7-364d-4945-889d-51c2fc3b74de" /><br><br>2. `参照ファイル`をクリックし、動画ファイルを選択<br><br><img width="auto" height="auto" alt="image" src="https://github.com/user-attachments/assets/7d88eb76-f682-44c4-a7ee-bcf36ddf2075" />     | 1. `動画ファイル`をクリック<br><br><img width="auto" height="auto" alt="image" src="https://github.com/user-attachments/assets/6d906632-0c1c-444c-8aa6-a0447137dfb8" /><br><br>2. `ファイル`をクリックし、動画ファイルを選択<br><br><img width="auto" height="auto" alt="image" src="https://github.com/user-attachments/assets/b790401c-8784-4dc8-9f0b-363164970013" />     |

8. 必要に応じて動画と音声の位置を調整してください。**動画フレームがレーン付きスロットパーティクルと一致していることを確認**

<img width=50% height="auto" alt="image" src="https://github.com/user-attachments/assets/78b91894-57c7-424a-af2d-3ee6f2ff8fb8" />

9. `設定@pjsekai-overlay`に移動し、**`オフセット`を調整**

<img width="auto" height="auto" alt="image" src="https://github.com/user-attachments/assets/433a1e1f-a24b-4518-8526-e73192eaf38a" />

10. 完了後、動画をmp4形式で出力します
   - **AviUtl:** `ファイル > プラグイン出力 > かんたんMP4出力` または `ファイル > プラグイン出力 > 拡張 x264 出力(GUI) Ex`
   - **AviUtl ExEdit2:** `ファイル > ファイル出力 > MP4 Exporter (by えすご/Esugo)`

# UIカスタマイズ仕様書
> [!TIP]
> `default.ini`でデフォルト値を変更できます。**これによりAviUtlで値を変更する必要が軽減されます。**
> 
> <img width=70% height=70% alt="image" src="https://github.com/user-attachments/assets/bd2151ad-2045-46ef-96c2-cbbb426a68d9" />

### 設定@pjsekai-overlay
<img width="383" height="79" alt="image" src="https://github.com/user-attachments/assets/76da6c77-f6a7-4480-b279-b5d53f3e583f" />

| **名前**         | 説明                                                                                                    | デフォルト     |        範囲           |
|---------------   |------------------------------------------------------------------------------------------------------------	|:-------:	|:------------------:	|
| **オフセット**<br>`offset`    | タイミングをシフトするフレーム数<br>- 増加するとタイミングが遅くなる<br>- 減少するとタイミングが早くなる 	|  216.00  	| -99999.99 ~ 99999.99 	|
| **キャッシュ**<br>`cache`    	| キャッシュが0に設定されている場合、`data.ped`の変更は即時反映されます<br>(`0` - OFF, `1` - ON)                               	|    1    	|        0か1      	|
| **テキスト言語**<br>`text_lang`     | エラーと詳細統計のテキスト言語設定<br>(`0` - 日本語, `1` - English)                     |    0        |        0か1           |
| **透かし**<br>`watermark` 	   | 左下隅に透かしテキストを表示する                                                            	|   1 (ON)  	|          0か1         	|
| **詳細統計**<br>`detail_stat` 	| <img width="auto" height="auto" alt="image" src="https://github.com/user-attachments/assets/9e916e51-d888-497e-b649-b6e9b4a3b760" /><br>詳細統計を表示（測定・分析に有用）。_このテキストは出力時に表示されません_                     |    0 (OFF)        |        0か1           |

### ライフ@pjsekai-overlay
<img width="125" height="125" alt="LifeUP" src="https://github.com/user-attachments/assets/6f7a7db8-50bb-43cf-9463-5f46325c862e" /> <img width=30% height=30% alt="life-v1" src="https://github.com/user-attachments/assets/b467f932-fa04-4afa-bbf2-9aed811b0855" /> <img width=30% height=30% alt="life" src="https://github.com/user-attachments/assets/7aab3534-66cf-4dad-936e-3d423ecce615" />

| **名前**         | 説明                                                                                                    | デフォルト     |        範囲           |
|----------	|-------------------------------------------------------------------------------------	|:-------:	|:--------:	|
| **ライフ**<br>`life` 	| LIFEの値（自明）<br>- 値が変化すると、LIFEバーも変化します 	|   1000  	| 0 ~ 9999 (整数) 	|
| **スキル効果**<br>`life_skill`     | スキルの光り効果を切り替え     |  0 (OFF)      |    0か1       |
| **過剰なライフバー**<br>`overflow` 	| <img width=70% height=70% alt="life_overflow-v1" src="https://github.com/user-attachments/assets/2fd69cf1-a767-47e7-adc3-14ecd2d56ce6" /><br><img width=70% height=70% alt="life_overflow" src="https://github.com/user-attachments/assets/bbe6ea47-b8e8-498f-8e30-187ca8971c64" /> 	|  0 (OFF)  	|    0か1   	|
| **先頭ゼロ**<br>`lead_zero`     | LIFE値が1000未満の場合に「0」桁を追加     |  0 (OFF)      |    0か1       |

### スコア@pjsekai-overlay
<img width="125" height="125" alt="ScoreUP" src="https://github.com/user-attachments/assets/a5a8b0f0-035c-4951-8ae3-d2038945d86c" /> <img width=50% height=50% alt="bg" src="https://github.com/user-attachments/assets/3db93b3e-2280-46e1-a08f-00e50a5e5e8c" />

| **名前**         | 説明                                                                                                    | デフォルト     |        範囲           |
|----------------------	|------------------------------------------------	|:-------:	|:------:	|
| **最小桁数**<br>`min_digit`        	| スコアの桁数を最小限に表示する   	|    8    	| 1 ~ 99 (整数)	|
| **スキル効果**<br>`score_skill`      | スキル発光効果の切り替え<br>`0`: OFF<br>`1`: AUTO - 各スキル発動時、5秒間スキル発光効果を表示<br>`2`: ON       |    1      | 0 ～ 2 (整数)    |
| **アニメーション速度**<br>`score_speed`	| アニメーション速度を調整する 	|    1.00    	|   0以上 	|
| **アニメーション採点**<br>`anim_score` 	| 一気にではなく、段階的に増やす 	|  0 (OFF)  	|    0か1   	|
| **「ユメステ」アニメーション**<br>`wds_anim` 	| ユメステの追加スコアアニメーションを切り替える 	|  0 (OFF)  	|   0か1   	|

> [!NOTE]
> **スキルイベントについて：https://sekai-guide.tootiejin.com/charting-guide/jpsukirutofeveribentono**

> [!TIP]
> **AUTOスキル効果を使用するためにスキルイベントを追加することは可能です。** `data.ped`ファイルを開き、追加したい各スキルイベントに対して`s|[時間枠 (秒)]`という行を追加してください。この行は必要な数だけ追加できます。
> - **例：**
> 
> <img width=50% height=50% alt="image" src="https://github.com/user-attachments/assets/44bb1ec6-5d42-467c-af1b-53b583d8ad44" />

### コンボ@pjsekai-overlay
<img width="148" height="49" alt="pt" src="https://github.com/user-attachments/assets/9db50558-cf81-4ed8-a2bd-1d4bbd22e156" /> <img width="145" height="45" alt="nt" src="https://github.com/user-attachments/assets/3ca0f65e-8ce6-40c9-8ff4-53a8ee9d2f81" />

| **名前**         | 説明                                                                                                    | デフォルト     |        範囲           |
|-----------------------------------	|----------------------------------------	|:-------:	|:-----:	|
| **APコンボ**<br>`ap`                      	| APコンボ状態を切り替える                 	|    1    	| 0か1 	|
| **コンボタグ**<br>`tag`                     	| コンボタグの表示切り替え             	|    1    	| 0か1 	|
| **最後のX桁を表示**<br>`last_digit` 	| `4`: 12345 -> /2345<br>`2`: 12345 -> ///45 |    4   	|  1以上 (整数)   	|
| **アニメーション速度**<br>`combo_speed`                     	| アニメーション速度を調整する 	|    1.00    	| 0以上	|
| **n00コンボ効果**<br>`combo_burst`            | ユメステのn00コンボ効果を切り替える |    0 (OFF)       |   0か1       |
| **達成率表示**<br>`achievement_rate`        	| <img width="auto" height="auto" alt="image" src="https://github.com/user-attachments/assets/1e1cc392-fc5d-4c7d-b954-a6eba95d8839" /><br>コンボカウンター上部に表示される達成率の切り替え **(`0`に設定するか、空白のままにすると無効になります)** <br><br>**追加機能:** <br>`100.0000+`: 100.0000%まで段階的に増加（アニメーション採点のように）<br>`100.0000-`: 100.0000%から開始し、非PERFECTな判定で減少 |    100.0000       |   有効な浮動小数点数       |

### 判定@pjsekai-overlay
<img width="125" height="125" alt="SkillUP" src="https://github.com/user-attachments/assets/e29f426d-71ae-4de5-912a-a5c7375f538d" />

| **名前**         | 説明                                                                                                    | デフォルト     |        範囲           |
|----------------	|-------------------------------------------------------------------------------	|:-------:	|:-----:	|
| **判定タイプ**<br>`judge` 	| `1`: <img width=25% height=25% alt="perfect" src="https://github.com/user-attachments/assets/28950e9e-0dac-49d9-81d3-70bdaa2d6f0c" /><br>`2`: <img width=25% height=25% alt="great" src="https://github.com/user-attachments/assets/ccf333a7-795d-43ad-8002-a9d2220e18a6" /><br>`3`: <img width=25% height=25% alt="good" src="https://github.com/user-attachments/assets/9d0a26bb-c8e7-47d0-9a3d-717b4ad0e0fa" /><br>`4`: <img width=25% height=25% alt="bad" src="https://github.com/user-attachments/assets/5b757195-8bd4-4beb-9f77-808000f1d865" /><br>`5`: <img width=25% height=25% alt="miss" src="https://github.com/user-attachments/assets/734ead15-491b-4bdb-9017-f2b30ab32223" /><br>`6`: <img width=25% height=25% alt="auto" src="https://github.com/user-attachments/assets/b9d674cf-1b69-478e-b2be-53691109b12d" /><br>`7 ~ 10`: カスタム判定 	|    1    	| 1 ~ 10 (整数) 	|
| **アニメーション速度**<br>`judge_speed`                     	| アニメーション速度を調整する 	|    1.00    	| 0以上	|

# よくある問題
### システムロケールの変更
システムロケールを「日本語（日本）」に変更してください：
`設定 > 時間と言語 > 言語 > 管理言語設定 > 「管理」タブ > システムロケールの変更`

<img width=40% height=40% alt="image" src="https://github.com/user-attachments/assets/db6ad3eb-9af8-4145-a362-4dab4af83a9e" />

### 言語パックのインストール

- [インストール手順はこちら](https://support.microsoft.com/ja-jp/windows/windows-%E7%94%A8%E8%A8%80%E8%AA%9E%E3%83%91%E3%83%83%E3%82%AF-a5094319-a92d-18de-5b53-1cfc697cfca8)

### インポート時のアニメーション速度低下
`ファイル > プロジェクトを新規作成` を選択し、フレームレートを60に設定してください。この変更は今後のインポートに反映されます。

<img width="420" height="178" alt="image" src="https://github.com/user-attachments/assets/a8015d9e-9024-486f-9182-571911f11c1c" />

### UIに何も表示されない / PEDファイルを開くことができません
おそらく **`data.ped`ファイル** を選択していません。
- **AviUtl:** `pjsekai-overlay-APPEND\dist\[譜面ID]` ディレクトリ内の `data.ped` を特定し、そのパスを `設定@pjsekai-overlay > 設定 > PEDファイルパス` にコピーしてください。**(`\ (¥)` を `\\ (¥¥)` か `/` に置き換えることを必ず確認してください)。**

<img width=50% height="auto" alt="image" src="https://github.com/user-attachments/assets/c75b651b-a3fe-4535-8d2b-7d52258580fa" />

- **AviUtl ExEdit2:** `設定@pjsekai-overlay-2` に移動し、`PEDファイル`を選択し、`pjsekai-overlay-APPEND\dist\[譜面ID]` ディレクトリ内の `data.ped` を選択します。

<img width="229" height="72" alt="image" src="https://github.com/user-attachments/assets/ab303cee-8113-4f7a-a827-a16aac705702" />

### イントロが全てのオブジェクトを読み込まない
AviUtlは、何らかの理由で初回インポート時に読み込みを停止することがあります。その場合、**再度インポートする必要があるかもしれません。**

### フォントが正しく表示されない場合

プロセカでは**ロダンNTLG DB + EB**フォントを使用しています（詳細は[必須事項](#必須事項)に記載）。これらは有料フォントのため、インストール方法の公開はできません。

<img width=50% height=50% alt="image" src="https://github.com/user-attachments/assets/9c125788-ab05-4fc0-8d2a-6f3e5d9c892a" />

### まだ質問がある場合や問題が発生している場合は？
**[議論スレッドを作成してください。](https://github.com/TootieJin/pjsekai-overlay-APPEND/discussions)**